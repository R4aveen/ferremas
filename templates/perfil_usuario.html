{% extends 'base.html' %}
{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Perfil de Usuario</title>
    {% block css %}
        <link rel="stylesheet" href="{% static 'css/perfil.css' %}">
    {% endblock css %}
</head>
<body>
    {% block contenido %}
    <main class="main-perfil">
        <h1 class="titulo-perfil">Bienvenido, {{ usuario.username }}</h1>
        <div class="perfil-container">
            <div class="datos-personales">
                <h2>Tus Datos Personales</h2>
                <form method="post" action="{% url 'actualizar_perfil' %}">
                    {% csrf_token %}
                    <label for="nombre">Nombre</label>
                    <input type="text" id="nombre" name="nombre" value="{{ usuario.first_name }}" required>

                    <label for="apellidos">Apellidos</label>
                    <input type="text" id="apellidos" name="apellidos" value="{{ usuario.last_name }}" required>

                    <label for="correo">Correo electrónico</label>
                    <input type="email" id="correo" name="correo" value="{{ usuario.email }}" required>

                    <label for="direccion">Dirección</label>
                    <input type="text" id="direccion" name="direccion" value="{{ usuario.direccion }}" required>

                    <div class="botones-accion">
                        <button type="submit" class="btn-guardar">Guardar</button>
                        <button type="button" class="btn-actualizar">Actualizar</button>
                    </div>
                </form>
            </div>
            <div class="historial-boletas">
                <h2>Tus Boletas</h2>
                <div class="boletas-scroll">
                    <ul>
                        {% for boleta in boletas %}
                            <li>
                                <strong>Boleta ID:</strong> {{ boleta.id }} - <strong>Total:</strong> ${{ boleta.total }} - <strong>Fecha:</strong> {{ boleta.fecha }}
                                <ul>
                                    {% for detalle in detalles_boletas %}
                                        {% if detalle.boleta.id == boleta.id %}
                                            <li>{{ detalle.producto.nombre }} - Cantidad: {{ detalle.cantidad }} - Subtotal: ${{ detalle.subtotal }}</li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="historial-pedidos">
            <h2>Tus Pedidos</h2>
            <div class="pedidos-scroll">
                <ul>
                    {% for pedido in pedidos %}
                        <li>
                            <strong>Pedido ID:</strong> {{ pedido.id }} - <strong>Estado:</strong> {{ pedido.estado }} - <strong>Fecha:</strong> {{ pedido.creado_en }}
                            <ul>
                                {% for item in pedido.items %}
                                    <li>{{ item.producto.nombre }} - Cantidad: {{ item.cantidad }}</li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </main>
</body>
<style>
    .main-perfil {
    margin: 20px auto;
    max-width: 800px;
}

.perfil-container {
    display: flex;
    justify-content: space-between;
    gap: 20px;
}

.datos-personales,
.historial-boletas {
    width: 45%;
}

.historial-pedidos {
    margin-top: 20px;
}

.boletas-scroll,
.pedidos-scroll {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #ddd;
    padding: 10px;
}

ul {
    list-style-type: none;
    padding: 0;
}

li {
    margin-bottom: 10px;
}

.btn-guardar {
    background-color: green;
    color: white;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
}

.btn-actualizar {
    background-color: orange;
    color: white;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
}

.btn-guardar:hover,
.btn-actualizar:hover {
    opacity: 0.8;
}

</style>
    {% endblock contenido %}
</html>
